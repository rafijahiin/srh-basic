<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maternal Mortality (MMR) Data Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Custom font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
        }
        /* Style for D3.js tooltips */
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font: 12px sans-serif;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        /* Custom styles for D3 axes */
        .axis path,
        .axis line {
            fill: none;
            stroke: #9ca3af; /* gray-400 */
            shape-rendering: crispEdges;
        }
        .axis text {
            font-size: 12px;
            fill: #4b5563; /* gray-600 */
        }
        .gridline {
            stroke: #e5e7eb; /* gray-200 */
            stroke-opacity: 0.7;
            shape-rendering: crispEdges;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Maternal Health in Bangladesh: A Data Story</h1>
        <p class="text-lg text-gray-600 mb-8">Visualizing key trends, successes, and challenges based on the latest data.</p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Chart 1: MMR Decline -->
            <div class="bg-white p-6 rounded-lg shadow-lg col-span-1 lg:col-span-2">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" id="chart1-title"></h2>
                <div id="chart1-container" class="w-full h-96"></div>
            </div>

            <!-- Chart 2: Service Improvement -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" id="chart2-title"></h2>
                <div id="chart2-container" class="w-full h-96"></div>
            </div>

            <!-- Chart 3: Inequity / Disparities -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" id="chart3-title"></h2>
                <div id="chart3-container" class="w-full h-96"></div>
            </div>

            <!-- Chart 4: Role of Midwives -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" id="chart4-title"></h2>
                <div id="chart4-container" class="w-full h-96"></div>
            </div>

            <!-- Chart 5: MMR Uncertainty -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-gray-700 mb-4" id="chart5-title"></h2>
                <div id="chart5-container" class="w-full h-96"></div>
            </div>

        </div>
    </div>

    <!-- Tooltip div -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tooltip
            const tooltip = d3.select("#tooltip");

            // Function to show tooltip
            const showTooltip = (event, d, content) => {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(content)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            };

            // Function to hide tooltip
            const hideTooltip = () => {
                tooltip.transition().duration(500).style("opacity", 0);
            };

            // === Chart 1: MMR Decline (Line Chart) ===
            function drawChart1() {
                const title = "Visual 1: Significant Decline in Maternal Mortality Ratio (MMR)";
                document.getElementById('chart1-title').textContent = title;

                const data = [
                    { year: 2016, value: 196, source: "BMMS" },
                    { year: 2019, value: 163, source: "SVRS" },
                    { year: 2021, value: 168, source: "SVRS" },
                    { year: 2022, value: 153, source: "SVRS" },
                    { year: 2023, value: 136, source: "SVRS" }
                ];
                
                const container = d3.select("#chart1-container");
                const bounds = container.node().getBoundingClientRect();
                const margin = { top: 20, right: 30, bottom: 50, left: 60 };
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // Scales
                const x = d3.scaleLinear()
                    .domain(d3.extent(data, d => d.year))
                    .range([0, width]);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.value) + 50]) // Start from 0, add padding
                    .range([height, 0]);

                // Axes
                const xAxis = d3.axisBottom(x).tickFormat(d3.format("d")); // Format as integer
                const yAxis = d3.axisLeft(y);
                
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(xAxis);

                svg.append("g")
                    .attr("class", "axis")
                    .call(yAxis);
                
                // Y-axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left + 10)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("MMR (deaths per 100,000 live births)");

                // X-axis label
                svg.append("text")
                    .attr("y", height + margin.bottom - 10)
                    .attr("x", width / 2)
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("Year");
                    
                // Add Y gridlines
                svg.append("g")
                    .attr("class", "gridline")
                    .call(d3.axisLeft(y)
                        .tickSize(-width)
                        .tickFormat("")
                    );

                // Line generator
                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d.value))
                    .curve(d3.curveMonotoneX); // Smooth curve

                // Draw the line
                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "#3b82f6") // blue-500
                    .attr("stroke-width", 3)
                    .attr("d", line);

                // Draw data points
                svg.selectAll(".dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("cx", d => x(d.year))
                    .attr("cy", d => y(d.value))
                    .attr("r", 5)
                    .attr("fill", "#3b82f6")
                    .on("mouseover", (event, d) => {
                        showTooltip(event, d, `<strong>Year:</strong> ${d.year}<br><strong>MMR:</strong> ${d.value} (${d.source})`);
                    })
                    .on("mouseout", hideTooltip);

                // Add "Over 300" annotation
                svg.append("text")
                    .attr("x", x(2016))
                    .attr("y", y(210)) // Position above the 196 point
                    .attr("text-anchor", "start")
                    .attr("class", "text-xs fill-gray-500")
                    .text("Down from >300 in 2000s");
                    
                // Add SDG Target line
                const sdgTarget = 70;
                svg.append("line")
                    .attr("x1", 0)
                    .attr("x2", width)
                    .attr("y1", y(sdgTarget))
                    .attr("y2", y(sdgTarget))
                    .attr("stroke", "#10b981") // emerald-500
                    .attr("stroke-width", 2)
                    .attr("stroke-dasharray", "5,5");

                svg.append("text")
                    .attr("x", width)
                    .attr("y", y(sdgTarget) - 5)
                    .attr("text-anchor", "end")
                    .attr("class", "text-xs font-semibold fill-emerald-500")
                    .text("SDG Target 2030 (70)");
            }

            // === Chart 2: Service Improvement (Grouped Bar) ===
            function drawChart2() {
                const title = "Visual 2: Growth in Key Maternal Health Services";
                document.getElementById('chart2-title').textContent = title;
                
                const data = [
                    { service: "ANC (Trained Provider)", year: "2011", value: 55 },
                    { service: "ANC (Trained Provider)", year: "2022", value: 88 },
                    { service: "PNC (within 2 days)", year: "2011", value: 29 },
                    { service: "PNC (within 2 days)", year: "2022", value: 55 },
                    { service: "Institutional Delivery", year: "2018", value: 50 },
                    { service: "Institutional Delivery", year: "2022", value: 65 },
                ];

                const container = d3.select("#chart2-container");
                const bounds = container.node().getBoundingClientRect();
                const margin = { top: 20, right: 20, bottom: 60, left: 50 };
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const services = [...new Set(data.map(d => d.service))];
                const years = [...new Set(data.map(d => d.year))].sort();

                // Scales
                const x0 = d3.scaleBand()
                    .domain(services)
                    .rangeRound([0, width])
                    .paddingInner(0.2);

                const x1 = d3.scaleBand()
                    .domain(years)
                    .rangeRound([0, x0.bandwidth()])
                    .padding(0.05);

                const y = d3.scaleLinear()
                    .domain([0, 100]) // Percentage
                    .range([height, 0]);

                const color = d3.scaleOrdinal()
                    .domain(years)
                    .range(["#93c5fd", "#1d4ed8"]); // light blue, dark blue

                // Axes
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x0))
                    .selectAll("text")
                    .style("text-anchor", "center");
                
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + "%"));
                
                // Y-axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left + 10)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("Percentage (%)");
                
                // Gridlines
                svg.append("g")
                    .attr("class", "gridline")
                    .call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(""));

                // Draw bars
                const serviceGroup = svg.selectAll(".service-group")
                    .data(services)
                    .enter().append("g")
                    .attr("class", "service-group")
                    .attr("transform", d => `translate(${x0(d)},0)`);

                serviceGroup.selectAll("rect")
                    .data(d => data.filter(item => item.service === d))
                    .enter().append("rect")
                    .attr("x", d => x1(d.year))
                    .attr("y", d => y(d.value))
                    .attr("width", x1.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", d => color(d.year))
                    .on("mouseover", (event, d) => {
                        showTooltip(event, d, `<strong>${d.service}</strong><br>${d.year}: ${d.value}%<br>
                                            <span class='text-xs'>${d.year === '2018' ? '(2018 baseline)' : ''}</span>`);
                    })
                    .on("mouseout", hideTooltip);
                
                // Legend
                const legend = svg.selectAll(".legend")
                    .data(years)
                    .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", (d, i) => `translate(0,${i * 20})`);

                legend.append("rect")
                    .attr("x", width - 100)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", width - 78)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "start")
                    .attr("class", "text-sm")
                    .text(d => d === '2011' ? '2011 Baseline' : (d === '2018' ? '2018 Baseline' : '2022'));
            }

            // === Chart 3: Disparities (Grouped Bar) ===
            function drawChart3() {
                const title = "Visual 3: Stark Disparities in Healthcare Access (2023)";
                document.getElementById('chart3-title').textContent = title;
                
                const data = [
                    { metric: "Home Delivery", group: "Displaced", value: 72 },
                    { metric: "Home Delivery", group: "Non-Displaced", value: 39 },
                    { metric: "Skilled Birth Attendant", group: "Displaced", value: 44 },
                    { metric: "Skilled Birth Attendant", group: "Non-Displaced", value: 77 },
                    { metric: "Received No ANC", group: "Displaced", value: 28 },
                    { metric: "Received No ANC", group: "Non-Displaced", value: 11 },
                ];

                const container = d3.select("#chart3-container");
                const bounds = container.node().getBoundingClientRect();
                const margin = { top: 20, right: 20, bottom: 60, left: 50 };
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
                
                const metrics = [...new Set(data.map(d => d.metric))];
                const groups = [...new Set(data.map(d => d.group))];

                // Scales
                const x0 = d3.scaleBand()
                    .domain(metrics)
                    .rangeRound([0, width])
                    .paddingInner(0.2);

                const x1 = d3.scaleBand()
                    .domain(groups)
                    .rangeRound([0, x0.bandwidth()])
                    .padding(0.05);

                const y = d3.scaleLinear()
                    .domain([0, 100]) // Percentage
                    .range([height, 0]);

                const color = d3.scaleOrdinal()
                    .domain(groups)
                    .range(["#f87171", "#60a5fa"]); // red-400, blue-400

                // Axes
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x0))
                    .selectAll("text")
                    .attr("transform", "rotate(-15)")
                    .style("text-anchor", "end");
                
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + "%"));
                
                // Y-axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left + 10)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("Percentage (%)");
                
                // Gridlines
                svg.append("g")
                    .attr("class", "gridline")
                    .call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(""));

                // Draw bars
                const metricGroup = svg.selectAll(".metric-group")
                    .data(metrics)
                    .enter().append("g")
                    .attr("class", "metric-group")
                    .attr("transform", d => `translate(${x0(d)},0)`);

                metricGroup.selectAll("rect")
                    .data(d => data.filter(item => item.metric === d))
                    .enter().append("rect")
                    .attr("x", d => x1(d.group))
                    .attr("y", d => y(d.value))
                    .attr("width", x1.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", d => color(d.group))
                    .on("mouseover", (event, d) => {
                        showTooltip(event, d, `<strong>${d.group}</strong><br>${d.metric}: ${d.value}%`);
                    })
                    .on("mouseout", hideTooltip);
                
                // Legend
                const legend = svg.selectAll(".legend")
                    .data(groups)
                    .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", (d, i) => `translate(0,${i * 20})`);

                legend.append("rect")
                    .attr("x", width - 120)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                legend.append("text")
                    .attr("x", width - 98)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "start")
                    .attr("class", "text-sm")
                    .text(d => d);
            }

            // === Chart 4: Role of Midwives (Simple Bar) ===
            function drawChart4() {
                const title = "Visual 4: Rising Impact of Midwives";
                document.getElementById('chart4-title').textContent = title;
                
                const data = [
                    { year: "2018", value: 24 },
                    { year: "2023", value: 89 }
                ];
                
                const container = d3.select("#chart4-container");
                const bounds = container.node().getBoundingClientRect();
                const margin = { top: 20, right: 20, bottom: 50, left: 50 };
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
                
                // Scales
                const x = d3.scaleBand()
                    .domain(data.map(d => d.year))
                    .range([0, width])
                    .padding(0.4);

                const y = d3.scaleLinear()
                    .domain([0, 100]) // Percentage
                    .range([height, 0]);

                // Axes
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));
                
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + "%"));
                
                // Y-axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left + 10)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("% of Normal Vaginal Deliveries Managed");
                
                // Gridlines
                svg.append("g")
                    .attr("class", "gridline")
                    .call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(""));

                // Draw bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.year))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", "#2dd4bf") // teal-400
                    .on("mouseover", (event, d) => {
                        showTooltip(event, d, `<strong>Year: ${d.year}</strong><br>Value: ${d.value}%`);
                    })
                    .on("mouseout", hideTooltip);
                
                // Add data labels on bars
                svg.selectAll(".bar-label")
                    .data(data)
                    .enter().append("text")
                    .attr("class", "bar-label text-sm font-medium fill-gray-700")
                    .attr("x", d => x(d.year) + x.bandwidth() / 2)
                    .attr("y", d => y(d.value) - 5)
                    .attr("text-anchor", "middle")
                    .text(d => d.value + "%");
            }
            
            // === Chart 5: MMR Uncertainty (Bar w/ Error Bars) ===
            function drawChart5() {
                const title = "Visual 5: MMR Estimates & Confidence Intervals";
                document.getElementById('chart5-title').textContent = title;

                const data = [
                    { year: "2016 (BMMS)", value: 196, min: 159, max: 234 },
                    { year: "2023 (SVRS)", value: 136, min: 90, max: 182 }
                ];
                
                const container = d3.select("#chart5-container");
                const bounds = container.node().getBoundingClientRect();
                const margin = { top: 20, right: 20, bottom: 50, left: 50 };
                const width = bounds.width - margin.left - margin.right;
                const height = bounds.height - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
                
                // Scales
                const x = d3.scaleBand()
                    .domain(data.map(d => d.year))
                    .range([0, width])
                    .padding(0.4);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.max) + 20]) // Go up to max error
                    .range([height, 0]);

                // Axes
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));
                
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y));
                
                // Y-axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left + 10)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .attr("class", "text-sm fill-gray-600")
                    .text("MMR (Point Estimate & 95% CI)");

                // Gridlines
                svg.append("g")
                    .attr("class", "gridline")
                    .call(d3.axisLeft(y).tickSize(-width).tickFormat(""));
                
                // Bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.year))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", d => (d.year.startsWith("2016") ? "#fbbf24" : "#fca5a5")) // amber-400, red-300
                    .on("mouseover", (event, d) => {
                        showTooltip(event, d, `<strong>${d.year}</strong><br>Estimate: ${d.value}<br>Range: ${d.min} - ${d.max}`);
                    })
                    .on("mouseout", hideTooltip);

                // Error bars
                const errorBars = svg.selectAll(".error-bar")
                    .data(data)
                    .enter().append("g")
                    .attr("class", "error-bar")
                    .attr("transform", d => `translate(${x(d.year) + x.bandwidth() / 2}, 0)`);

                // Vertical line
                errorBars.append("line")
                    .attr("x1", 0)
                    .attr("x2", 0)
                    .attr("y1", d => y(d.min))
                    .attr("y2", d => y(d.max))
                    .attr("stroke", "#4b5563") // gray-600
                    .attr("stroke-width", 2);

                // Top cap
                errorBars.append("line")
                    .attr("x1", -5)
                    .attr("x2", 5)
                    .attr("y1", d => y(d.max))
                    .attr("y2", d => y(d.max))
                    .attr("stroke", "#4b5563")
                    .attr("stroke-width", 2);

                // Bottom cap
                errorBars.append("line")
                    .attr("x1", -5)
                    .attr("x2", 5)
                    .attr("y1", d => y(d.min))
                    .attr("y2", d => y(d.min))
                    .attr("stroke", "#4b5563")
                    .attr("stroke-width", 2);
            }

            // Draw all charts
            drawChart1();
            drawChart2();
            drawChart3();
            drawChart4();
            drawChart5();
            
            // Redraw charts on window resize
            window.addEventListener('resize', () => {
                d3.select("#chart1-container").selectAll("*").remove();
                d3.select("#chart2-container").selectAll("*").remove();
                d3.select("#chart3-container").selectAll("*").remove();
                d3.select("#chart4-container").selectAll("*").remove();
                d3.select("#chart5-container").selectAll("*").remove();
                drawChart1();
                drawChart2();
                drawChart3();
                drawChart4();
                drawChart5();
            });
        });
    </script>
    
</body>
</html>
